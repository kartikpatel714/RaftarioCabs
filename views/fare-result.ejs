<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('partials/head', { title: 'Fare Results - RaftarioCabs' }) %>
        <style>
            body {
                margin-top: 7%;
            }

            .fare-box {
                background: #fff;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 15px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }

            .fare-box img {
                width: 50px;
                margin-right: 10px;
            }

            .price-tag {
                background: #ffcc00;
                padding: 8px 15px;
                border-radius: 5px;
                font-weight: bold;
                border: none;
                cursor: pointer;
            }

            #map {
                height: 300px;
                width: 100%;
                border-radius: 10px;
                margin-top: 15px;
            }

            .breadcrumb {
                background-color: transparent;
                padding: 0.75rem 1rem;
            }
        </style>
</head>

<body class="bg-light">
    <%- include('partials/header', { currentPage: 'fare' }) %>

        <div class="container mt-4">
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="#" id="pickup-location">
                            <%= pickup %>
                        </a></li>
                    <li class="breadcrumb-item active" id="drop-location">
                        <%= drop %>
                    </li>
                </ol>
            </nav>

            <div class="fare-box">
                <h5><strong id="route-title">
                        <%= pickup %> to <%= drop %>
                    </strong></h5>
            </div>

            <% cabTypes.forEach(cab=> { %>
                <div class="fare-box d-flex align-items-center">
                    <img src="<%= cab.image %>" alt="<%= cab.type %>">
                    <div class="flex-grow-1">
                        <strong>
                            <%= cab.type %>
                        </strong><br>
                        <%= cab.models %>
                    </div>
                    <button class="price-tag" onclick="bookRide('<%= cab.type %>', <%= cab.fare %>)">
                        ₹ <%= cab.fare.toFixed(2) %>
                    </button>
                </div>
                <% }); %>

                    <!-- App Download Buttons -->
                    <div class="text-center my-4">
                        <a href="https://play.google.com/store" target="_blank">
                            <img src="/images/google-play.png" alt="Google Play" width="150">
                        </a>
                        <a href="https://apps.apple.com/" target="_blank">
                            <img src="/images/app-store.png" alt="App Store" width="150">
                        </a>
                    </div>

                    <!-- Fare Info -->
                    <div class="fare-box text-center">
                        <strong>No Return Fare</strong> | Trusted by Thousands | Highly Rated (4.2 ⭐)
                    </div>

                    <!-- FAQ Section -->
                    <div class="fare-box">
                        <h5>
                            <%= pickup %> to <%= drop %> Cab Details
                        </h5>
                        <% faqs.forEach(faq=> { %>
                            <p><a href="#" data-bs-toggle="modal" data-bs-target="#faqModal"
                                    data-question="<%= faq.question %>" data-answer="<%= faq.answer %>">
                                    Q: <%= faq.question %>
                                </a></p>
                            <% }); %>
                    </div>
        </div>

        <!-- FAQ Modal -->
        <div class="modal fade" id="faqModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="faqModalTitle">FAQ</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <h6 id="faqQuestion"></h6>
                        <p id="faqAnswer"></p>
                    </div>
                </div>
            </div>
        </div>

        <%- include('partials/footer') %>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            <script src="https://maps.googleapis.com/maps/api/js?key=<%= googleApiKey %>&libraries=places"></script>
            <script>
                // Initialize Google Map
                function initMap(pickup, drop) {
                    // Map initialization code would go here
                    console.log(`Initializing map for ${pickup} to ${drop}`);
                }

                // Book Ride Function
                function bookRide(carType, fare) {
                    const tripData = {
                        pickup: '<%= pickup %>',
                        drop: '<%= drop %>',
                        carType: carType,
                        fare: fare,
                        date: new Date().toISOString()
                    };

                    fetch('/api/bookings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(tripData)
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                window.location.href = `/booking-confirmation/${data.bookingId}`;
                            } else {
                                alert('Booking failed: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('An error occurred while processing your booking');
                        });
                }

                // FAQ Modal Handling
                document.addEventListener('DOMContentLoaded', function () {
                    const faqModal = document.getElementById('faqModal');
                    if (faqModal) {
                        faqModal.addEventListener('show.bs.modal', function (event) {
                            const button = event.relatedTarget;
                            document.getElementById('faqQuestion').textContent = button.getAttribute('data-question');
                            document.getElementById('faqAnswer').textContent = button.getAttribute('data-answer');
                        });
                    }

                    // Initialize map if needed
                    initMap('<%= pickup %>', '<%= drop %>');
                });
            </script>
</body>

</html>